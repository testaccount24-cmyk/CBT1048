***(ID)                            JES2B007
***(SUBSYSTEM)                     JES2
***(DESIGNER)                      D.A.MOORCROFT
***(AUTHOR)                        D.A.MOORCROFT
*
***(DATE WRITTEN)                  SECOND QUARTER 1977.
***(DATE TESTED)                   SECOND QUARTER 1977.
***(DATE INSTALLED)                SECOND QUARTER 1977.
*
***(ABSTRACT)
*
*        THIS ROUTINE IS A SERVICE ROUTINE WHICH DECHAINS A SECONDARY APCE
*         FROM THE PRIMARY APCE AND RETRUNS IT TO THE AVAILABLE QUEUE.
*        NOTE THAT IT MAY BE USED TO RETURN EITHER A SPECIFIC APCE ( BY
*         NAME NAME OR BY ADDRESS ), OR TO RETURN ALL SECONDARY APCE'S
*         OWNED BY THE CURRENT PRIMARY APCE.
*
***(LOGIC SUMMARY)
*
*        1. DETERMINE WHETHER R1 POINTS AT THE NAME OF THE APCE TO BE FREED
*           OR THE ( COMPLEMENTED ) ADDRESS OF THE APCE TO BE FREED.
*        2. IF R1 POINTS AT A NAME, LOCATE THE ADDRESS OF THE APCE.
*        3. DECHAIN THE SECONDARY APCE FROM THE PRIMARY APCE.
*        4. RETURN THE FREED APCE TO THE TOP OF THE AVAILABLE QUEUE ( USING
*           COMPARE AND SWAP TO ENSURE QUEUE INTEGRITY ).
*        5. IF 'ALL' WAS SPECIFIED, REPEAT (3) AND (4) FOR EVERY SECONDARY
*           APCE CHAINED TO THE PRIMARY.
*        6. IF THE FREEING EMPTIES THE PRIMARY APCE OF SECONDARIES, SET OFF
*           THE FLAG THAT INDICATES SECONDARY APCE'S ARE PRESENT.
*
***(INSTALLATION)
*
*        THIS MOD. IS DYNAMICALLY LOADED AT INITILISATION TIME
*         UPON REQUEST VIA AN 'EXIT=' CONTROL CARD.
*
***(TESTING)
*
*        THIS MOD. CAN BE CONSIDERED AS GOOD, IF ALL THE OTHER
*         MODS ARE USING IT ARE WORKING SUCCESSFULLY.
*
*        IF CURRENT VERSION OF THIS MOD. IS MODIFIED, THE ONLY WAY
*         TO TEST IT IS TO FORCE A DUMP AFTER $FREEAPCE MACRO
*         AND CHECK IF 2NDRY APCE IS REALLY FREED.
