***(ID)                            JES2B000
***(SUBSYSTEM)                     JES2
***(DESIGNER)                      D.A.MOORCROFT
***(AUTHOR)                        D.A.MOORCROFT
*
***(DATE WRITTEN)                  07 MAR 77
***(DATE TESTED)                   MARCH 1977
***(DATE INSTALLED)                MARCH 1977
*
***(ABSTRACT)
*
*        IN ORDER TO MINIMISE THE NUMBER OF CHANGES MADE TO JES2 CODE,
*         WE TOOK THE DECISION TO PLACE AS MUCH OF THE MODIFICATIONS
*         AS POSSIBLE OUTSIDE JES2 IN SEPARATE DYNAMICALLY LOADED
*         PROGRAMS.  THIS MODIFICATION IS THE FUNDAMENTAL CONTROL
*         ROUTINE WHICH DETERMINES THE LOCATION OF THE REQUIRED PROGRAM
*         AND BRANCHES TO IT.  CUNNING USE OF THE REGISTERS ENABLES THE
*         INVOKED ROUTINE TO RETURN DIRECTLY TO THE CALLER, AND GIVES THE
*         INVOKED ROUTINE TOTAL ADDRESSABILITY AS IF IT WERE IN-LINE CODE.
*        BEFORE BRANCHING TO THE REQUESTED ROUTINE ( ASSUMING THAT IT IS
*         AVAILABLE ), THIS DISPATCHER ACQUIRES AN APCE FROM THE POOL CREATED
*         BY THE AUXILIARY INITIALISATION ROUTINE ( JES2B001 ) AND INITIALISES
*         IT, AND INITIALISES ALL REGISTERS IN ACCORDANCE WITH THE USAGE
*         CONVENTIONS OF OUR ADDITIONAL PROCESSING ROUTINES.
*
***(LOGIC SUMMARY)
*
*        THIS MODIFICATION IS A ROUTINE - SO WRITTEN THAT IT DOES NOT REQUIRE
*         A BASE REGISTER - THAT IS LOADED BY THE AUXILIARY INITIALISATION
*         ROUTINE.  THE ADDRESS OF THIS ROUTINE IS STORED IN AN EXTRA FIELD
*         WITHIN THE HCT ( HCT$B000 ).  CONTROL IS PASSED TO THIS DISPATCHER
*         FROM THE EXPANSION OF THE $CBAL MACRO.
*
*        THE DISPATCHER PERFORMS THE FOLLOWING FUNCTIONS :-
*         1. DETERMINES IF THE REQUESTED ROUTINE EXISTS ( I.E. WAS DEFINED
*            BY AN 'EXIT' CONTROL CARD AT INITIALISATION TIME ), IS AVAILABLE
*            FOR EXECUTION ( I.E. HAS NOT BEEN DISABLED BY A 'NOEXEC' KEYWORD
*            IN A CONTROL CARD, OR BY AN ERROR ), AND MAY BE INVOKED VIA A
*            $CBAL MACRO ( SOME ROUTINES ARE INVOKED VIA OTHER ROUTING MODULES).
*            IF THE REQUESTED ROUTINE DOES NOT SATISFY THESE TESTS, CONTROL IS
*            RETURNED TO THE CALLER WITH THE COND CODE IN THE PSW SET HIGH.
*         2. AN APCE IS ACQUIRED FROM THE POOL, AND THE CALLERS REGISTERS
*            ARE PRESERVED IN IT.
*         3. THE REGISTERS ARE INITIALISED IN ACCORDANCE WITH THE USAGE
*            CONVENTIONS OF OUR MODIFICATION ROUTINES.  SPECIFICALLY,
*            ADDRESSABILITY IS ESTABLISHED TO THE REQUESTED ROUTINE, THE HCT,
*            THE AHCT, THE CALLER'S PCE, AND THE ACQUIRED APCE.
*         4. CONTROL IS PASSED TO THE REQUESTED ROUTINE.
*
*        THE $CBAL MACRO IS THE MECHANISM BY WHICH AN EXTERNAL MODIFICATION
*         IS INVOKED FROM WITHIN JES2 CODE, AND IS THE ONLY CARD OF ANY
*         GIVEN MODIFICATION THAT IS ACTUALLY PLACED WITHIN JES2.
*         THE MACRO IS OF THE FORM :-
*              $CBAL RTN-NAME<,YES=ADDR><,NO=ADDR><,ALL=ADDR><,ERR=ADDR>
*         AND THE EXPANSION IS OF THE FORM :-
*              LA    RN,CODE       SET CODE EQUIVALENT TO RTN-NAME
*              BAL   R14,HCT$CBAL  BRANCH TO ROUTINE IN HCT
*              BH    ERR-ADDR      REQUESTED FUNCTION DISABLED/MISSING
*              BE    YES-ADDR      MODIFICATION RETURNS SUCCESSFUL CODE
*              BL    NO-ADDR       MODIFICATION RETURNS BAD COMPLETION
*              B     ALL-ADDR      BRANCH WITHOUT REGARD FOR RESULT
*
*        JUDICIOUS SELECTION OF THE KEYWORDS FOR THE $CBAL MACRO CAN ENSURE
*         THAT, IF A ROUTINE IS SUPPRESSED BY OMITTING THE CONTROL CARD OR BY
*         AN ERROR,  NORMAL JES2 PROCESSING WILL TAKE OVER WHERE APPROPRIATE.
*
*        THE INVOKED EXIT ROUTINES SET THE PSW CONDITION CODE BY MEANS
*         OF THE INSTRUCTIONS :-
*              CLI   *,$$W         SET COND CODE LOW
*              CLI   *,$$X         SET COND CODE EQUAL
*              CLI   *,$$Y         SET COND CODE HIGH
*         ( $$W, $$X, $$Y ARE EQUATED TO X'96', X'95', X'94' RESPECTIVELY ).
*
***(INSTALLATION)
*
*        SEE THE AUXILIARY INITILISATION ROUTINE ( JES2B001 ).
*
***(TESTING)
*
*        IF NO PROBLEMS WITH THE OTHER MODS, B000 CAN BE
*         CONSIDERED AS GOOD.
