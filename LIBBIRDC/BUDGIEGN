//DAMADD JOB (5921,5,,,100),'BUDGYGEN PROCEDURE',CLASS=N
//STEP01       EXEC PROCEDUR,LIB1='SYS1.PROCLIB'
//SYSIN        DD   DATA
MEMBER RNAME=BUDGYGEN
//BUDGYGEN     PROC MAN=DAM,       PROGRAMMER INITIALS
//*
//*      LIBRARYN OPTIONS
//*
//             FILE=BIRDCAGE,      SOURCE LIBRARY FOR BUDGIE
//             BLKSIZE=1680,       BLOCKED INPUT FOR ASSEMBLER G
//*
//*      ASSEMBLER G OPTIONS
//*
//             SYSOUT=L,           DEFERRED OUTPUT
//             ASMBLR=B,           BATCH ASSEMBLIES                    X
//             LISTING=TER,        SYSTERM DIAGNOSTICS REQUIRED        X
//             EXECUTE=NOEXEC,     NO EXECUTION OPTION                 X
//             OBJECT=LOAD,        OBJECT MODULE IS REQUIRED           X
//             CORE=2K,            2K SYSTEM SPACE IN PARTITION        X
//             BUFFERS=3,          SYSUT1,2&3 ARE BUFFERED             X
//             XREF=X,             COMPRESSED CROSS-REFERENCE LIST
//             USER=NOUPD,         USER MAY OVERRIDE THIS DEFAULT      X
//             UMAP=UMAP,          USING/DROP MAP
//             MESSAGE=A,          IMMEDIATE DIAGNOSTICS (IF ANY)
//*
//*      LINKAGE EDITOR OPTIONS
//*
//             LKED='XREF,LIST,LET,SIZE=(100K,30K)', LKED OPTIONS      X
//             DDNAME=SYSLMOD,     SHARDISK ENQUEUE NAME               X
//             DUMP=L,             DEFERRED DUMP                       X
//             LINKMAP=L,          DEFERRED LINKAGE EDITOR MAPS
//*
//*      BUDGIE3 OPTIONS
//*
//             INPUT=Z             NO LIST OF CONTROL CARDS OR INPUT
//*
//*      THIS PROCEDURE ASSEMBLES ANY SELECTED BUDGIE SOURCE CSECTS,
//*       AND MERGES THE OBJECT DECKS WITH A SEQUENTIAL DATA SET
//*       CONTAINING PREVIOUSLY CREATED OBJECT MODULES, IN ORDER TO
//*       CREATE ALL NECESSARY INPUT TO THE LINKAGE EDITOR TO CREATE
//*       A NEW LOAD MODULE.  THE DATA SET '&MAN..BUDGOBJ' IS UPDATED
//*       SO THAT IT CONTAINS ONLT THE MOST RECENT OBJECT DECK FOR
//*       EACH CSECT.
//*
//LIBRARYN     EXEC PGM=LIBRARY,
//*
//*      SELECT AND MODIFY BUDGIE CSECTS
//*
//             PARM='DEPTH=60,IEX=IEX,NJTA,NRJS',REGION=70K
//MASTER       DD   DSN=LIBRARYN.&FILE,DISP=SHR
//STEPLIB      DD   DSN=SYS2.LIBRN53,DISP=SHR
//SYSPRINT     DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//INDEX        DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//LIST         DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//OSJOB        DD   DSN=&&OSJOB,DISP=(,PASS),UNIT=SYSDA,
//             SPACE=(TRK,(38,38),RLSE),DCB=BLKSIZE=&BLKSIZE
//SYSPUNCH     DD   SYSOUT=B,DCB=BLKSIZE=80
//ASM          EXEC PGM=ASMG,REGION=128K,
//             PARM=(&ASMBLR,&LISTING,&EXECUTE,&OBJECT,
//*
//*      ASSEMBLE BUDGIE ( BATCH ASSEMBLIES )
//*
//             'SPACE=MAX-&CORE','UB=&BUFFERS',&XREF,&USER,&UMAP)
//*
//* REFER TO ASSEMBLER G MANUAL FOR EXPLANATION OF ASSEMBLER OPTIONS.
//* &USER IS SUPPLIED TO ALLOW FOR NON-STANDARD OPTIONS.
//*
//STEPLIB  DD      DSN=SYS2.ASMG27,DISP=SHR
//SYSLIB   DD      DSN=SYS1.MACLIB,DISP=SHR
//         DD      DSN=SYS2.MACLIB,DISP=SHR
//SYSPRINT DD      SYSOUT=&SYSOUT
//SYSTERM  DD      SYSOUT=&MESSAGE
//SYSUDUMP DD      SYSOUT=&DUMP
//SYSUT1   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSUT2   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSUT3   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSGO    DD      DSN=&&LOADSET,UNIT=SYSDA,DISP=(,PASS),              X
//             SPACE=(CYL,(1,1)),DCB=BLKSIZE=800
//SYSIN        DD   DSN=&&OSJOB,DISP=(OLD,DELETE)
//SORT         EXEC PGM=BUDGIE1,COND=(9,LT,ASM)
//*
//*      TREAT OBJECT DECKS AS BATCHES, AND SORT THEM, OUTPUTING DECKS
//*       IN CSECT NAME SEQUENCE, SO THAT, FOR A GIVEN CSECT, THE OLD
//*       DECK FOLLOWS THE NEW ( IF ANY ).
//*
//STEPLIB      DD   DSN=SYS1.LINKLIB2,DISP=SHR
//SYSUDUMP     DD   SYSOUT=A
//SYSPRINT     DD   SYSOUT=&INPUT
//SYSLIST      DD   SYSOUT=&INPUT
//SYSUT1       DD   DSN=&&LOADSET,DISP=(OLD,DELETE)
//             DD   DSN=&MAN..BUDGOBJ,DISP=SHR
//SYSUT2       DD   DSN=&&DECKS,DISP=(,PASS),UNIT=SYSDA,
//             SPACE=(TRK,(5,5),RLSE),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=800)
//SYSIN        DD   DSN=SYS2.CONTRLIB(BUDGYGEN),DISP=SHR
//SORTLIB      DD   DSN=SYS1.SORTLIB,DISP=SHR
//SORTWK01     DD   UNIT=SYSDA,SPACE=(CYL,5)
//SORTWK02     DD   UNIT=SYSDA,SPACE=(CYL,5)
//SORTWK03     DD   UNIT=SYSDA,SPACE=(CYL,5)
//REJECT       EXEC PGM=BUDGIE3,COND=(9,LT,ASM),REGION=190K
//*
//*      REJECT OLD DECKS IF NEW EXIST
//*
//STEPLIB      DD   DSN=SYS1.LINKLIB2,DISP=SHR
//SYSUDUMP     DD   SYSOUT=A
//SYSPRINT     DD   SYSOUT=&INPUT
//PRINT        DD   SYSOUT=&INPUT
//WORK         DD   UNIT=SYSDA,SPACE=(CYL,5)
//SYSUT1       DD   DSN=&&DECKS,DISP=(OLD,DELETE)
//SYSUT2       DD   DSN=&MAN..BUDGOBJ,DISP=OLD,SPACE=(TRK,(5,5),RLSE)
//SYSIN        DD   DSN=SYS2.CONTRLIB(BUDGYGEN),DISP=SHR
//LKED     EXEC    PGM=SHARDISK,PARM=(&DDNAME,IEWL,'&LKED'),           X
//*
//*      CREATE NEW LOAD MODULE FROM CURRENT AND OLD OBJECT DECKS
//*
//             COND=(9,LT,ASM),REGION=208K
//SYSPRINT DD      SYSOUT=&LINKMAP
//SYSUDUMP DD      SYSOUT=&DUMP
//SYSLIB   DD      DSN=SYS1.LINKLIB,DISP=SHR
//         DD      DSN=SYS1.LINKLIB2,DISP=SHR                            0000350
//             DD   DSN=SYS2.TESTLIB,DISP=SHR
//SYSLIN       DD   DSN=&MAN..BUDGOBJ,DISP=SHR
//         DD      DDNAME=SYSIN
//SYSUT1   DD      UNIT=SYSDA,SPACE=(1024,(50,20),RLSE)
//SYSLMOD      DD   DSN=SYS2.TESTLIB(BUDGY&MAN),DISP=SHR
/*
//STEP02       EXEC UPDATE,LIB1='SYS2.CONTRLIB'
./   REPL      NAME=BUDGYGEN
SKIP1
*        THE PURPOSE OF THIS SET OF BUDGIE CONTROL CARDS IS TO MAINTAIN
*         A SEQUENTIAL DATA SET CONTAINING OBJECT DECKS FOR THE VARIOUS
*         BUDGIE CSECTS, KEEPING THE MOST RECENT OBJECT DECK OF EACH.
SKIP1
*        EACH OBJECT DECK IS TREATED AS A 'BATCH', AND THE FOLLOWING
*         PROPERTIES OF AN OBJECT DECK ARE UTILISED:-
*         . COLUMNS 77-80 CONTAIN A 4-DIGIT SEQUENCE NUMBER
*         . THE 1ST ESD CARD HAS A SEQUENCE NUMBER OF '0001'
*         . THE 1ST ESD CARD COMTAINS THE CSECT NAME IN 17-24
SKIP1
*        BUDGIE1 IS USED TO SORT THE 'BATCHES' INTO ASCENDING BATCH
*         NUMBER ( I.E. CSECT NAME ) SEQUENCE.  THE SEQUENCE OF THE
*         CONCATENATED INPUT DATA SETS ( NEW DECKS FOLLOWED BY THE OLD
*         DECKS ON THE PERMANENT DATA SET ), ENSURES THAT, FOR A GIVEN
*         CSECT, THE NEW DECK OCCURS FIRST IN THE OUTPUT.
SKIP1
*        BUDGIE3 ACCEPTS THESE SORTED 'BATCHES', AND REJECTS DUPLICATE
*         'BATCH' NUMBERS.  THUS, IF A NEW DECK HAS BEEN CREATED, THEN
*         THE OLD DECK IS DISCARDED.
SKIP1
*        THIS MS02 CARD CAUSES A CARD WITH '0001' IN COLUMNS 77-80 TO
*         BE TREATED AS A BATCH CARD, AND USES COLUMNS 17-24 FOR THE
*         BATCH NUMBER.  OUTPUT RECORDS ARE 80 BYTES LONG.
SKIP1
MS027740001                  0801        178
SKIP1
*        THIS UNQUALIFIED MS11 CARD CAUSES ALL INPUT TO BE RECOGNISED
*         AND PASSED FOR OUTPUT WITHOUT FURTHER PROCESSING
SKIP1
MS11
SKIP1
*        REJECT ( I.E. DELETE ) RECORDS WHOSE IDENTIFIER ( IN COLUMNS
*         2-4 ) ARE NOT ESD, RLD, TXT, END, IDE(NTIFY).
SKIP1
MS13                                00203C12 ID
MS34ID0053ESDRLDTXTENDIDE
./   ENDUP
