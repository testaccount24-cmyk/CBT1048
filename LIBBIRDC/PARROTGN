//DAMPARGN JOB (5921,5),'GENERATION PROCEDURE',CLASS=N,NOTIFY=DAM
/*ROUTE  PRINT REMOTE13
//STEP01       EXEC PROCEDUR,LIB1='SYS1.PROCLIB'
//SYSIN        DD   DATA
MEMBER RNAME=PAROTGEN
//PAROTGEN     PROC MAN=SYS2,      PROGRAMMER INITIALS
//             BIRD=PAR,           SOURCE TO BE ASSEMBLED: PAR / BUDG
//*
//*      LIBRARYN OPTIONS
//*
//             FILE=BIRDCAGE,      SOURCE LIBRARY FOR PARROT
//             BLKSIZE=1680,       BLOCKED INPUT FOR ASSEMBLER
//*
//*      ASSEMBLER H OPTIONS
//*
//             SYSOUT=A,           IMMEDIATE OUTPUT ( 'L' FOR DEFERRED )
//             ASMBLR=BATCH,       BATCH ASSEMBLIES
//             DECK=NODECK,        NO SYSPUNCH OUTPUT
//             OBJECT=OBJECT,      OBJECT MODULE ON SYSGO
//             LIST=LIST,          PRODUCE PROGRAM LISTING
//             ESD=ESD,            INCLUDE ESD IN OUTPUT LISTING
//             RLD=RLD,            INCLUDE RLD IN OUTPUT LISTING
//             ALIGN=ALIGN,        FLAG ALIGNMENT ERRORS
//             XREF='XREF(SHORT)', SHORT-FORM CROSS-REFERENCE LISTING
//             TERM=TERM,          USE SYSTERM DATA SET FOR DIAGNOSTICS
//             TEST=NOTEST,        NO TESTRAN PROCESSING
//             RENT=NORENT,        NO TESTS FOR RE-ENTRABILITY ERRORS
//             SYSPARM=LIST,       USER MAY OVERRIDE THIS DEFAULT
//             USER=LIST,          USER MAY OVERRIDE THIS DEFAULT
//             MESSAGE=A,          IMMEDIATE DIAGNOSTICS (IF ANY)
//*
//*      LINKAGE EDITOR OPTIONS
//*
//             LINK=NE,            SUPPRESS LINK EDIT STEP
//*                                'LINK=EQ' TRIGGERS LINK EDIT
//*
//             LKED='MAP,XREF,LIST,LET,SIZE=(100K,30K)', LKED OPTIONS  X
//             DDNAME=SYSLMOD,     SHARDISK ENQUEUE NAME               X
//             DUMP=L,             DEFERRED DUMP                       X
//             LINKMAP=A,          IMMEDIATE LINKAGE EDITOR MAPS
//*                                ( 'L' FOR DEFERRED LINKAGE MAPS )
//*
//*      BUDGIE3 OPTIONS
//*
//             INPUT=Z             LIST OF INPUT OBJECT DECKS SUPRESSED
//*
//*      THIS PROCEDURE ASSEMBLES ANY SELECTED PARROT SOURCE CSECTS,
//*       AND MERGES THE OBJECT DECKS WITH A SEQUENTIAL DATA SET
//*       CONTAINING PREVIOUSLY CREATED OBJECT MODULES, IN ORDER TO
//*       CREATE ALL NECESSARY INPUT TO THE LINKAGE EDITOR TO CREATE
//*       A NEW LOAD MODULE.  THE DATA SET '&MAN..&BIRD.OBJ' IS UPDATED
//*       SO THAT IT CONTAINS ONLT THE MOST RECENT OBJECT DECK FOR
//*       EACH CSECT.
//*
//LIBRARYN     EXEC PGM=LIBRARY,
//*
//*      SELECT AND MODIFY PARROT CSECTS
//*
//             PARM='DEPTH=60,IEX=IEX,NJTA,NRJS'
//MASTER       DD   DSN=LIBRARYN.&FILE,DISP=SHR
//STEPLIB      DD   DSN=SYS2.LIBRN53,DISP=SHR
//SYSPRINT     DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//INDEX        DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//LIST         DD   SYSOUT=A,DCB=(RECFM=FM,LRECL=133,BLKSIZE=133)
//OSJOB        DD   DSN=&&OSJOB,DISP=(,PASS),UNIT=SYSDA,
//             SPACE=(TRK,(38,38),RLSE),DCB=BLKSIZE=&BLKSIZE
//SYSPUNCH     DD   SYSOUT=B,DCB=BLKSIZE=80
//ASM      EXEC    PGM=ASMH,REGION=256K,
//*
//*      ASSEMBLE PARROT ( BATCH ASSEMBLIES )
//*
//             PARM=(&LIST,&ESD,&RLD,&DECK,&ASMBLR,&OBJECT,'&XREF',
//             &ALIGN,&RENT,&TERM,&TEST,&SYSPARM,&USER)
//*
//* REFER TO ASSEMBLER H MANUAL FOR EXPLANATION OF ASSEMBLER OPTIONS.
//* &USER IS SUPPLIED TO ALLOW FOR NON-STANDARD OPTIONS.
//*
//STEPLIB  DD      DSN=SYS2.ASMG27,DISP=SHR
//SYSLIB   DD      DSN=SYS2.&BIRD.MACS,DISP=SHR  INDIVIDUAL MACROS
//         DD      DSN=SYS2.PARMACS,DISP=SHR     COMMON MACROS
//         DD      DSN=SYS1.MACLIB,DISP=SHR
//         DD      DSN=SYS2.MACLIB,DISP=SHR
//         DD      DSN=SYS2.AMODGEN,DISP=SHR
//SYSPRINT DD      SYSOUT=&SYSOUT
//SYSTERM  DD      SYSOUT=&MESSAGE
//SYSUDUMP DD      SYSOUT=&DUMP
//SYSUT1   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSUT2   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSUT3   DD      UNIT=SYSDA,SPACE=(CYL,(5,1))
//SYSGO    DD      DSN=&&LOADSET,UNIT=SYSDA,DISP=(,PASS),              X
//             SPACE=(CYL,(1,1)),DCB=BLKSIZE=800
//SYSIN        DD   DSN=&&OSJOB,DISP=(OLD,DELETE)
//SORT         EXEC PGM=BUDGIE1,COND=(9,LT,ASM),REGION=128K
//*
//*      TREAT OBJECT DECKS AS BATCHES, AND SORT THEM, OUTPUTING DECKS
//*       IN CSECT NAME SEQUENCE, SO THAT, FOR A GIVEN CSECT, THE OLD
//*       DECK FOLLOWS THE NEW ( IF ANY ).
//*
//STEPLIB      DD   DSN=SYS1.LINKLIB2,DISP=SHR
//SYSUDUMP     DD   SYSOUT=A
//SYSPRINT     DD   DUMMY
//SYSLIST      DD   DUMMY
//SYSUT1       DD   DSN=&&LOADSET,DISP=(OLD,DELETE)
//             DD   DSN=&MAN..&BIRD.OBJ,DISP=SHR
//SYSUT2       DD   DSN=&&DECKS,DISP=(,PASS),UNIT=SYSDA,
//             SPACE=(TRK,(5,5),RLSE),
//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=800)
//SYSIN        DD   DSN=SYS2.CONTRLIB(PAROTGEN),DISP=SHR
//SORTLIB      DD   DSN=SYS1.SORTLIB,DISP=SHR
//SORTWK01     DD   UNIT=SYSDA,SPACE=(CYL,5)
//SORTWK02     DD   UNIT=SYSDA,SPACE=(CYL,5)
//SORTWK03     DD   UNIT=SYSDA,SPACE=(CYL,5)
//REJECT       EXEC PGM=BUDGIE3,COND=(9,LT,ASM)
//*
//*      REJECT OLD DECKS IF NEW EXIST
//*
//STEPLIB      DD   DSN=SYS1.LINKLIB2,DISP=SHR
//SYSUDUMP     DD   SYSOUT=A
//SYSPRINT     DD   SYSOUT=&INPUT
//PRINT        DD   SYSOUT=&INPUT
//WORK         DD   UNIT=SYSDA,SPACE=(CYL,5)
//SYSUT1       DD   DSN=&&DECKS,DISP=(OLD,DELETE)
//SYSUT2       DD   DSN=&MAN..&BIRD.OBJ,DISP=OLD,SPACE=(TRK,(5,5),RLSE)
//SYSIN        DD   DSN=SYS2.CONTRLIB(PAROTGEN),DISP=SHR
//LKED     EXEC    PGM=SHARDISK,PARM=(&DDNAME,IEWL,'&LKED'),           X
//*
//*      CREATE NEW LOAD MODULE FROM CURRENT AND OLD OBJECT DECKS
//*
//             COND=((9,LT,ASM),(1,&LINK,SORT)),REGION=128K
//SYSPRINT DD      SYSOUT=&LINKMAP
//SYSUDUMP DD      SYSOUT=&DUMP
//SYSLIB   DD      DSN=SYS1.LINKLIB,DISP=SHR
//         DD      DSN=SYS1.LINKLIB2,DISP=SHR
//         DD      DSN=SYS2.TESTLIB,DISP=SHR
//SYSLIN   DD      DSN=&MAN..&BIRD.OBJ,DISP=SHR
//         DD      DDNAME=SYSIN
//SYSUT1   DD      UNIT=SYSDA,SPACE=(1024,(50,20))
//SYSLMOD  DD      DSN=SYS2.TESTLIB,DISP=SHR
/*
//STEP02       EXEC PROCEDUR,LIB1='SYS1.PROCLIB'
//SYSIN        DD   DATA
MEMBER RNAME=PAROTLNK
//PAROTLNK     PROC MAN=SYS2,      PROGRAMMER INITIALS
//             BIRD=PAR,           OBJECT DECKS TO LINK: PAR / BUDG
//*
//*      LINKAGE EDITOR OPTIONS
//*
//             LKED='MAP,XREF,LIST,LET,SIZE=(100K,30K)', LKED OPTIONS  X
//             DDNAME=SYSLMOD,     SHARDISK ENQUEUE NAME               X
//             DUMP=L,             DEFERRED DUMP                       X
//             LINKMAP=A           IMMEDIATE LINKAGE EDITOR MAPS
//*                                ( 'L' FOR DEFERRED LINKAGE MAPS )
//*
//*      THIS PROCEDURE LINK EDITS THE PARROT OR BUDGIE OBJECT DECKS
//*       THAT ARE IN THE DATA SET '&MAN..&BIRD.OBJ', AND PLACES THE
//*       RESULTANT LOAD MODULES ON 'SYS2.TESTLIB'.
//*
//*      THE OBJECT MODULE DATA SET '&MAN..&BIRD.OBJ' IS MAINTAINED
//*       BY THE PRIMARY PARROT/BUDGIE GENERATION PROCEDURE 'PAROTGEN'.
//*
//LKED     EXEC    PGM=SHARDISK,PARM=(&DDNAME,IEWL,'&LKED'),           X
//*
//*      CREATE NEW LOAD MODULE FROM CURRENT AND OLD OBJECT DECKS
//*
//             REGION=128K
//SYSPRINT DD      SYSOUT=&LINKMAP
//SYSUDUMP DD      SYSOUT=&DUMP
//SYSLIB   DD      DSN=SYS1.LINKLIB,DISP=SHR
//         DD      DSN=SYS1.LINKLIB2,DISP=SHR
//         DD      DSN=SYS2.TESTLIB,DISP=SHR
//SYSLIN   DD      DSN=&MAN..&BIRD.OBJ,DISP=SHR
//         DD      DDNAME=SYSIN
//SYSUT1   DD      UNIT=SYSDA,SPACE=(1024,(50,20))
//SYSLMOD  DD      DSN=SYS2.TESTLIB,DISP=SHR
/*
//STEP03       EXEC UPDATE,LIB1='SYS2.CONTRLIB'
./   REPL      NAME=PAROTGEN
SKIP1
*        THE PURPOSE OF THIS SET OF BUDGIE CONTROL CARDS IS TO MAINTAIN
*         A SEQUENTIAL DATA SET CONTAINING OBJECT DECKS FOR THE VARIOUS
*         PARROT CSECTS, KEEPING THE MOST RECENT OBJECT DECK OF EACH.
SKIP1
*        EACH OBJECT DECK IS TREATED AS A 'BATCH', AND THE FOLLOWING
*         PROPERTIES OF AN OBJECT DECK ARE UTILISED:-
*         . COLUMNS 77-80 CONTAIN A 4-DIGIT SEQUENCE NUMBER
*         . THE 1ST ESD CARD HAS A SEQUENCE NUMBER OF '0001'
*         . THE 1ST ESD CARD COMTAINS THE CSECT NAME IN 17-24
SKIP1
*        BUDGIE1 IS USED TO SORT THE 'BATCHES' INTO ASCENDING BATCH
*         NUMBER ( I.E. CSECT NAME ) SEQUENCE.  THE SEQUENCE OF THE
*         CONCATENATED INPUT DATA SETS ( NEW DECKS FOLLOWED BY THE OLD
*         DECKS ON THE PERMANENT DATA SET ), ENSURES THAT, FOR A GIVEN
*         CSECT, THE NEW DECK OCCURS FIRST IN THE OUTPUT.
SKIP1
*        BUDGIE3 ACCEPTS THESE SORTED 'BATCHES', AND REJECTS DUPLICATE
*         'BATCH' NUMBERS.  THUS, IF A NEW DECK HAS BEEN CREATED, THEN
*         THE OLD DECK IS DISCARDED.
SKIP1
*        THIS MS02 CARD CAUSES A CARD WITH '0001' IN COLUMNS 77-80 TO
*         BE TREATED AS A BATCH CARD, AND USES COLUMNS 17-24 FOR THE
*         BATCH NUMBER.  OUTPUT RECORDS ARE 80 BYTES LONG.
SKIP1
MS027740001                  0801        178
SKIP1
*        THIS UNQUALIFIED MS11 CARD CAUSES ALL INPUT TO BE RECOGNISED
*         AND PASSED FOR OUTPUT WITHOUT FURTHER PROCESSING, WITH THE
*         EXCEPTION THAT INVALID OBJECT DECK 'CARDS' ARE REJECTED.
SKIP1
MS11
SKIP1
*        REJECT ( I.E. DELETE ) CARDS WHOSE IDENTIFIERS ( IN COLS 2-4 )
*         ARE NOT ESD, RLD, TXT, END, IDE(NTIFY)
SKIP1
MS13                                00203C12 ID
MS34ID0053ESDRLDTXTENDIDE
SKIP3
*        RECOGNISE AS A 'BATCH CARD' A CARD WITH 'ZZZZZZZZ' IN COLUMNS
*         36-43, TREATING 'ZZZZZZZZ' AS THE BATCH NUMBER ALSO, TO ALLOW
*         LINKAGE EDITOR CONTROL CARDS TO BE MAINTAINED AT THE END OF
*         THE CONCATENATED OBJECT DECK.  THESE LINKAGE EDITOR CONTROL
*         CARDS ARE SUPPLIED BY THE MODULE 'PARROTNA' VIA REPRO STATEMEN
SKIP1
MS02368ZZZZZZZZ              0801        368
MS11
./   ENDUP
