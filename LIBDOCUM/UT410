1************
 * UT410    *
 ************
0UT410
 -----
01. PURPOSE
 ----------
0   A GENERALISED CURRENCY CONVERSION SUBROUTINE.
02. LIMITATIONS
 -------------
0   MUST BE DYNAMICALLY LOADED AT EXECUTION TIME.
03. INPUT DATA
 -------------
0   (A)  A PARAMETER AREA PASSED TO THE SUBROUTINE CONTAINING -
         INPUT CURRENCY CODE, VALUE OF CURRENCY TO BE CONVERTED AND
         THE ULTIMATE CURRENCY CODE.
0   (B)  A PARAMETER AREA PASSED TO THE SUBROUTINE TO RECEIVE THE
         RESULTANT CURRENCY VALUES.
04. OUTPUT DATA
 --------------
0   AS ABOVE III. (B).
05. OPERATION
 ------------
0   JOB CONTROL LANGUAGE:
 -----------------------
    //JOBNAME      JOB  1,PGNAME,MSGLEVEL=1
    //JOBLIB       DD   DSNAME=LIBRARY CONTAINING UT410
    //             EXEC PROBLEM PROGRAM
    //DNAME1       DD   (DD INFORMATION FOR PROBLEM PROGRAM)
    //DDNAME2      DD        ETC.
    //DDNAME2      DD        ETC.
    //DDNAME2      DD        ETC.
0   PARAMETER FIELDS REQUIRED:
    -------------------------
0   SOURCE PARAMETER
0   1-2            INPUT CURRENCY CODE
    3              STERLING INDICATOR: '1' - 1-POSN PENCE
                                       '2' - 2-POSN PENCE
                                       '3' - PENCE ONLY
                                       ' ' - ALL OTHER CURRENCIES
    4-17           VALUE TO BE CONVERTED  (UNPACKED)
    18-19          OPTIONAL EXTRA TWO DECIMAL PLACES
    20-21          CURRENCY CODE
                   OUTPUT
1************
 * UT410    *
 ************
0        INPUT CURRENCY CODE
         -------------------
0        TWO BYTE FIELD CONTAINING THE CURRENCY CODE OF THE INPUT
         VALUE SUPPLIED TO THE SUBROUTINE.
0        L.STERLING INDICATOR
         --------------------
0        ONE BYTE FIELD CONTAINING THE VALUE 1, 2, 3 OR BLANK.  A
         VALUE MUST BE PRESENT IF POUNDS SHILLINGS AND PENCE ARE
         BEING PROCESSED.
0        VALUE TO BE CONVERTED
         ---------------------
0        SIXTEEN BYTE FIELD CONTAINING THE INPUT VALUE TO BE CONVERTED.
         ALL INPUT VALUES MUST BE ALIGNED AS INDICATED - I.E., RIGHT
         ADJUSTED TO FIELD POSITION 14.
0        CURRENCIES OTHER THAN POUNDS SHILLINGS AND PENCE, ARE EXPECTED
         WITH TWO DECIMAL PLACES AND MUST BE ALIGNED AS SHOWN IN (D)
         ABOVE.
0        FIELD POSITIONS 15 AND 16 CAN BE USED, IF AN EXTRA TWO DECIMAL
         PLACES ARE SUPPLIED.
0        IF FIELD POSITIONS 15 AND 16 ARE USED, THE SIGN WILL BE TAKEN
         FROM FIELD POSITION 16 FOR ALL CURRENCIES.
0        IF FIELD POSITIONS 15 AND 16 ARE NOT USED, THE SIGN WILL BE
         TAKEN AS FOLLOWS:-
0        STERLING, 1 POSN PENCE   - SIGN JUNIOR L.
         STERLING, 2 POSN PENCE   - SIGN JUNIOR PENCE.
         STERLING, PENCE ONLY     - SIGN JUNIOR PENCE.
         ALL OTHER CURRENCIES     - SIGN JUNIOR DIGIT.
0   N.B. IF FIELD POSITIONS 15 AND 16 ARE USED WITH POUNDS, SHILLINGS
         AND PENCE THIS WILL BE TAKEN AS MEANING TWO DECIMAL PLACES
         OF PENCE.
0             E.G.       LLLLSSD.DD
                        LLLLSSDD.DD
                          DDDDDD.DD
0        ULTIMATE CURRENCY CODE
         ----------------------
0        TWO BYTE FIELD CONTAINING THE CURRENCY CODE OF THE CURRENCY
         TO WHICH THE SUPPLIED VALUE IS TO BE CONVERTED.
0        A LIST OF ALL CURRENCY CODES IS ENCLOSED.
1************
 * UT410    *
 ************
0RESULT PARAMETER
0     1-20         EDITED DECIMAL POUNDS
     21-36         UNEDITED DECIMAL  POUNDS
     37-56         EDITED POUNDS STERLING
     57-72         UNEDITED POUNDS STERLING
     73-92         EDITED DOLLARS
     93-108        UNEDITED DOLLARS
    109-128        EDITED OUTPUT CURRENCY
    129-144        UNEDITED OUTPUT CURRENCY
    145-149        ABBREVIATED  DESCRIPTION OF OUTPUT  CURRENCY
    150-159        CONVERSION FACTOR:  INPUT CURRENCY TO DOLLARS
    160            RESULT INDICATOR: '1' - RESULTS OK
                                     '2' - RESULTS NOT OK.
0   L.DEC - EDITED
    --------------
0   TWENTY BYTE FIELD THAT WILL CONTAIN A RESULT VALUE ROUNDED TO
    FOUR DECIMAL PLACES OF POUNDS AND EDITED FOR PRINTING.
0   NOT EDITED
    ----------
0   SIXTEEN BYTE FIELD THAT WILL CONTAIN A RESULT VALUE ROUNDED TO
    FOUR DECIMAL PLACES OF POUNDS WITHOUT EDITING, AND WILL CONTAIN
    A SIGN OVER THE JUNIOR POSITION.
0   STERLING - EDITED L.S.D.
    ------------------------
0   TWENTY BYTE FIELD THAT WILL CONTAIN A RESULT VALUE ROUNDED
    TO THE NEAREST PENNY AND EDITED AS POUNDS, SHILLINGS AND PENCE
    FOR PRINTING.
0   PENCE
    -----
0   SIXTEEN BYTE FIELD THAT WILL CONTAIN A RESULT VALUE IN PENCE
    ROUNDED TO THE NEAREST PENNY, WITH A SIGN OVER THE JUNIOR POSITION.
0   DOLLARS - EDITED
    ----------------
0   TWENTY BYTE FIELD THAT WILL CONTAIN A RESULT VALUE ROUNDED TO
    TWO DECIMAL PLACES AND EDITED FOR PRINTING.
0   NOT EDITED
    ----------
0   SIXTEEN BYTE FIELD THAT WILL CONTAIN A RESULT VALUE ROUNDED TO TWO
    DECIMAL PLACES WITHOUT EDITING, AND WILL CONTAIN A SIGN OVER THE
    JUNIOR POSITION.
1************
 * UT410    *
 ************
0        ULTIMATE CURRENCY - EDITED
         --------------------------
0        TWENTY BYTE FIELD THAT WILL CONTAIN A RESULT VALUE IN WHATEVER
         CURRENCY SPECIFIED, ROUNDED TO AS MANY DECIMAL PLACES AS REQUIRED
         BY THE SPECIFIED CURRENCY AND EDITED FOR PRINTING.
0        NOT EDITED
         ----------
0        SIXTEEN BYTE FIELD THAT WILL CONTAIN A RESULT VALUE IN WHATEVER
         CURRENCY SPECIFIED, ROUNDED TO AS MANY DECIMAL PLACES AS REQUIRED
         BY THE SPECIFIED CURRENCY, WITHOUT EDITING AND WITH A SIGN OVER
         THE JUNIOR POSITION.
0   N.B. STERLING, UNEDITED WILL ALWAYS APPEAR AS PENCE.
0        ABBREVIATED DESCRIPTION
         -----------------------
0        FIVE BYTE FIELD THAT WILL CONTAIN THE ABBREVIATED DESCRIPTION
         OF THE ULTIMATE CURRENCY.
0        INITIAL CONVERSION FACTOR
         -------------------------
0        TEN BYTE FIELD THAT WILL CONTAIN THE CONVERSION FACTOR THAT
         WAS USED TO CONVERT THE INPUT CURRENCY TO DOLLARS.  THIS FACTOR
         IS TO FIVE DECIMAL PLACES.
0        RESULT INDICATOR
         ----------------
0        ONE BYTE FIELD THAT WILL CONTAIN 1 OR ZERO ON COMPLETING
         EXECUTION OF THE SUBROUTINE.
0        1 INDICATES THAT THE SUBROUTINE WAS ABLE TO FUNCTION CORRECTLY.
0        0 INDICATES THAT FOR SOME REASON THE SUBROUTINE WAS NOT ABLE TO
         FUNCTION CORRECTLY E.G., INVALID CURRENCY CODES SUPPLIED OR
         CONVERSION FACTOR NOT PRESENT IN LOAD MODULE.
0        THIS INDICATOR CAN BE TESTED BY THE USER PROGRAM AND THE
         NECESSARY ACTION TAKEN.
0        THE COMPLETE PARAMETER AREA WILL BE FILLED WITH CHARACTER ZEROS
         IF AN ERROR CONDITION IS ENCOUNTERED.
1************
 * UT410    *
 ************
0                       CALLING UT410 FROM COBOL
                        ------------------------
0        UT410 MUST BE CALLED DYNAMICALLY AT EXECUTION TIME BECAUSE
    ALL THE CURRENCY CONVERSION FACTORS ARE BUILT INTO THE LOAD MODULE.
    THIS WAS DONE INTENTIONALLY IN ORDER TO SAVE THE CORE STORAGE REQUIRED
    TO ACCOMMODATE AN ACCESS METHOD.
0        USING THIS METHOD, UT410 WILL BE RECOMPILED WHENEVER A
    CHANGE TO THE CONVERSION FACTORS ARE REQUIRED.
0        RECOMPILATION ON A 360/30 TAKES APPROXIMATELY 3 MINUTES.
0        TO ALLOW DYNAMIC LOAD AND EXECUTES, THREE SUBROUTINES
    ARE AVAILABLE, DYNAML/DYNAMO/DYNAMD:-
0        DYNAML
         ------
0        INITIALISATION SUBROUTINE TO DYNAMICALLY LOAD A MODULE TO
    CORE.
0        DYNAMO
         ------
0        SUBROUTINE TO DYNAMICALLY LOAD A MODULE TO CORE, EXECUTE IT
    AND THEN DELETE IT FROM CORE.  IF DYNAML HAD PREVIOUSLY BEEN
    EXECUTED, THEN DYNAMO WILL NOT DELETE THE MODULE BUT WILL HAVE THE
    SAME EFFECT AS A BRANCH TO THAT LOADED MODULE.
0        DYNAMD
         ------
0        SUBROUTINE TO DELETE A MODULE FROM CORE (IF REQUIRED).
1************
 * UT410    *
 ************
0   WORKING-STORAGE SECTION.
    77  UT410  PICTURE X(8)  VALUE  'UT410  '.
    77            .             .
    77            .             .
    01  INPUT-PAR.
         03   INPUT-CURRENCY-CODE   PICTURE XX.
         03   POUND-INDICATOR       PICTURE X.
         03   INPUT-VALUE           PICTURE  9(16).
         03   ULTIMATE-CURRENCY-CODE   PICTURE XX.
0   01   OUTPUT-PAR.
         03   PDEC-EDITED    PICTURE  X(20).
         03   PDEC-NOT-EDITED  PICTURE  9(16).
         03   STERLING-L-S-D  PICTURE X(20).
         03   PENCE  PICTURE  9(16).
         03   DOLLARS-EDITED  PICTURE  X(20).
         03   DOLLARS-NOT-EDITED  PICTURE  9(16).
         03   ULTIMATE-EDITED  PICTURE  X(20).
         03   ULTIMATE-NOT-EDITED  PICTURE  9(16).
         03   ABBREV-DESCRIPTION  PICTURE  X(5).
         03   CONVERSION-FACTOR  PICTURE  9(10).
         03   RESULT-INDICATOR  PICTURE  X.
0   PROCEDURE DIVISION.
    INITIALISE.
         ENTER LINKAGE.
         CALL 'DYNAML' USING UT410.
         ENTER COBOL.
0   NEXT.     (NORMAL PROBLEM PROGRAM PROCESSING)
0        ENTER LINKAGE.
         CALL 'DYNAMO' USING UT410,
                             INPUT-PAR,
                             OUTPUT-PAR.
         ENTER COBOL.
0             (NORMAL PROBLEM PROGRAM PROCESSING)
0        GO TO NEXT.
0                  CURRENCY CONVERSION TABLE
                   -------------------------
0             ASSEMBLER SOURCE STATEMENTS 03000000 TO 07000200 INCLUSIVE.
0             THE ONLY VITAL TABLE ENTRIES ARE THOSE THAT HAVE A LABEL
    PUNCHED IN COLUMNS 1-8.  THE REST CAN BE REMOVED TO REDUCE THE SIZE
    OF THE MODULE IF IT IS FELT THAT THEY WILL NEVER BE REQUIRED.
0             COLUMNS.
              18 + 19   CURRENCY CODE.
              20 - 29   CONVERSION FACTOR TO FIVE DECIMAL PLACES
              30 - 34   ABBREVIATED CURRENCY NAME.
              35        DECIMAL PLACES INDICATOR.
1************
 * UT410    *
 ************
0        ONE PERSON SHOULD BE RESPONSIBLE FOR UPDATING THE
    CURRENCY CONVERSION TABLE AND FOR SUBMITTING THE SOURCE DECK FOR
    RECOMPILATION.
0        (RECOMPILATION = APPROXIMATELY 3 MINUTES ON 360/30).
1************
 * UT410    *
 ************
0                       CURRENCY CODES
                        --------------
0   01   ALGERIAN DINAR
    02   U.S.DOLLAR
    03   CANADIAN DOLLAR
    04   ANGOLA ESCUDO
    05   ARGENTINIAN PESOS
    06   AUSTRALIAN DOLLARS
    07   BARBADOS DOLLARS
    08   BERMUDAN POUNDS
    09   BOLIVIAN PESOS
    10   AUSTRIAN SCHILLINGS
    11   BELGIAN FRANCS
    12   LUXEMBOURG FRANCS
    13   BRAZILIAN CRUZEROS
    14   FRENCH FRANCS
    15   GERMAN MARKS
    16   ITALIAN LIRE
    17   NETHERLAND FLORIN
    18   SWISS FRANCS
    19   ENGLISH POUNDS STERLING
    20   BULGARIAN LEV.
    21   BURMESE KYAT
    22   CAMBODIAN RIEL
    23   CHILE ESCUDO
    24   GREEK DRACHMAS
    25   CHINESE DOLLARS
    26   COLUMBIAN PESOS
    27   CONGOLESE FRANCS
    28   COSTA RICAN COLON
    29   CUBAN PESOS
1************
 * UT410    *
 ************
    30   CYPRIOT POUNDS
    31   CZECHOSLOVAKIAN CROWNS
    32   PROTUGUESE ESCUDOS
    33   DOMINICAN REPUBLIC PESOS
    34   SPANISH PESETAS
    35   DANISH KRONER
    36   FINISH MARKS
    37   ECUADOR SUCRE
    38   EGYPTIAN POUNDS
    39   NORWEGIAN KRONER
    40   SWEDISH KRONER
    41   EL SALVADOR COLON
    42   ETHIOPIAN DOLLARS
    43   GUATEMALIAN QUETZAL
    44   HAITI GOURDES
    45   HONDURAS LEMPIRA
    46   HONG KONG DOLLARS
    47   HUNGARIAN FORINT
    48   ICELANDIC KRONA
    49   INDIAN RUPEES
    50   INDONESIAN NEW RUPIAH
    51   IRAN RIAL
    52   IRAQ DINAR
    53   ISRAELI POUNDS
    54   JAMAICAN POUNDS
    55   JAPANESE YEN
    56   JORDANIAN DINAR
    57   KENYAN SCHILLINGS
    58   SOUTH KOREAN WON
    59   LEBANESE POUNDS
    60   LIBERIAN DOLLARS
1************
 * UT410    *
 ************
    61   LIBYAN POUNDS
    62   MALAYSIAN DOLLARS
    63   MEXICAN PESOS
    64   NETHERLANDS ANTILLES GUILDERS
    65   NEW ZEALAND DOLLARS
    66   NICARAGUAN CORDOBA
    67   NIGERIAN POUNDS
    68   PAKISTANI RUPEES
    69   PANAMANIAN BALBOA
    70   PARAGUAYAN GUARANI
    71   PERUVIAN SOL
    72   PHILIPPINES PESOS
    73   POLISH ZLOTY
    75   PORTUGUESE EAST AFRICAN ESCUDOS
    76   RUMANIAN LEU
    77   SAUDI ARABIAN RIYAL
    78   SINGAPORE DOLLARS
    79   SOMALIAN SHILLINGS
    80   SOUTH AFRICAN RAND
    81   SOUTH WEST AFRICAN RAND
    82   SUDANESE POUNDS
    83   SURINAM GUILDER
    84   SWAZILAND RAND
    85   SYRIAN POUNDS
    86   TANZANIAN SCHILLINGS
    87   THAILAND BAHT
    88   TRINIDAD AND TOBAGO DOLLARS
    89   TUNISIAN DINARS
    90   TURKISH LIRA
    91   UGANDA SCHILLINGS
1************
 * UT410    *
 ************
    92   URAGUAYAN PESOS
    93   U.S.S.R. ROUBLES
    94   VENEZUELA BOLIVARES
    95   VIETNAMESE PIASTERS
    96   YUGOSLAVIAN DINARS
    97   ZAMBIAN POUNDS
    98   U.K. DECIMALISED POUNDS
    99   (NOT YET ALLOCATED)
