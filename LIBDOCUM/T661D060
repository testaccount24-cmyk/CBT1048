1                                     TOBY / SALES
0                                       T661P060
0                                  INPUT DATA PREPROCESSOR
0                                                               B WUILLAUME
0                                                                   05/77
- 1.   ENVIRONMENT.
       ------------
0          LANGUAGE  - ANS COBOL
           UTILITIES - UT458
           TABLES    - NONE
- 2.   PURPOSE.
       --------
0          CREATE LATEST INPUT BACK-UP FILE VERSION UPDATED WITH ALL THE
                      DAILY TRANSACTIONS
           COMPLETE DAILY TRANSACTION FILE WITH ALL ASSUMED FIELDS AND UPDATED
                      PRODUCTS
           CREATE CONTROL RECORDS
1 3.   INPUT FILES.
       ------------
0 3.1. DAILY TRANSACTIONS.
       -------------------
0          CONTAINS SALES TRANSACTIONS TO BE PROCESSED IN THIS RUN
           RECORD TYPES ARE
                - BS10 BS30   BUDGET DATA
                - BS14        HISTORICAL AND PROSPECT DATA
                - BS20        DEDUCTION OVERIDING.
                - BSPR        PRODUCT FILE UPDATE
                - OTHER       REQUESTS FOR REPORTS, BRIDGE ETC
0          DDNAME      : TSALDAILI
0          RECORD SIZE : 100 B
0          SEQUENCE    : POS 5-8,100,81-95,19-43,1-4
                SO WITHIN A GIVEN OPCO WE RECEIVE
                         BS00
                    THEN BSPR           CREATE UPDATED-PRODUCTS TABLE
                    THEN BS.. (DATA)    MATCHING WITH BUP FILE
                    THEN OTHERS         SIMPLY COPIED ON DAILY OUTPUT FILE
- 3.2. BACK-UP FILE.
       -------------
0      CONTAINS ALL SALES TRANSACTIONS NECESSARY TO CREATE ANY REPORTING FILE
       INTO THE SALES SYSTEM
           RECORD TYPES ARE
                - BS10        BUDGET DATA PRICES
                - BS14        HISTORICAL AND PROSPECT DATA
                - BS20        DEDUCTION
                - BS30        BUDGET DATA VALUES
0          DDNAME      : TSALBUPI
0          RECORD SIZE : 100 B
0          SEQUENCE    : SAME AS 3.1.
1 4.   OUTPUT FILES.
       -------------
0 4.1. DAILY TRANSACTIONS.
       -------------------
           SAME AS INPUT BUT WILL CONTAIN SOME RECORDS GENERATED FROM BUP FILE
           AND SOME OF THE INPUT RECORDS WILL BE COMPLETED
0          DDNAME      : TSALDAILO
0          RECORD SIZE : 100B
0          SEQUENCE    : SAME AS INPUT
0 4.2. BACK-UP FILE.
       -------------
           SAME AS INPUT BUT UPDATED WITH DAILY TRANSACTIONS.
           DDNAME      : TSALBUPO
           RECORD SIZE : 100B
           SEQUENCE    : SAME AS INPUT
***** ATTN.B.WUILLAUME PT.2 FIN    *****
- 5.   WORKING-STORAGE ORGANISATION.
       ------------------------------
0 5.1. UPDATED-PRODUCT TABLE.
       ----------------------
           FIRST CARDS RECEIVED WITHIN AN OPERATING COMPANY WILL BE 'BSPR' IF
           PRESENT. SELECT THOSE WITH BSPR1C AND NON BLANK STANDARD COST AND
           LOAD THEM IN AN INTERNAL TABLE.
                  CONTENT   - OPCO (POS 8)
                            - FP   (POS 81-90)
                            - MARKET GRP (POS 91-95)
                            - PLANT-OR (POS 19-22)
                  100 ENTRIES
                  PROVIDE NECESSARY DUMP & MESSAGE IN OVERFLOW SITUATION
           THIS TABLE WILL AUTOMATICALLY BE IN THE RIGHT SEQUENCE SO THAT IT
           CAN BE ACCESSED BY SEARCH ALL STATEMENT
           THIS TABLE IS TO BE REINITIALIZED AND RECREATED EVERY TIME A NEW
           COMPANY IS REACHED
           WILL BE ACCESSED EVERY TIME WE READ BS10 OR BS30 IN BUP FILE.IF
           MATCHING IS FOUND BS10/30 IS TO BE GENERATED ON DAILY OUTPUT FILE.
0 5.2. BS20 TABLE.
       -----------
0          ALL BS20 CARDS FOR MATCHED KEYS WILL BE STORED ON THIS TABLE FOR
           FURTHER GENERATION ON DAILY TRANSACTION AFTER ALL OTHER DATA OF
           THIS KEY WILL HAVE BEEN PROCESSED
                   17 POS   20 ENTRIES
                   POS 1-17  = BYTES 36-52 OF INPUT CARD BS20
1 6.   PROCESSING.
       -----------
0          MATCHING BETWEEN BACK-UP AND DAILY TRANSACTIONS FILES
                       KEY = POS 8,81-95,19-35,5
0 6.1. UNMATCHED BACK-UP RECORDS PROCESSING
           COPY ON BUP OUTPUT
           IF MATCHING IS FOUND WITH PRODUCT TABLE COPY ALSO ON DAILY FILE
0 6.2. UNMATCHED DAILY RECORDS PROCESSING.
           IF BSPR1C PROCESS AS EXPLAINED IN 5.1.
           COPY ALWAYS ON DAILY FILE
           IF BS10 BS14 BS20 OR BS30 COPY ALSO ON BUP FILE
0 6.3. MATCHED RECORDS PROCESSING.
         -IF BS14
               BLANK FIELDS OF DAILY RECORD ARE FILLED FROM BUP RECORDS
                      (QTY,GROSS,NET,COST,CURR)
               COPY RESULTING RECORDS ON DAILY TRANSACTIONS
               COPY THEN ALSO ON BUP FILE EXCEPT DELETE RECORDS (POS 42 = '*')
         -IF BS20 PRESENT ON EITHER FILE
               BUILD BS20 TABLE BY MATCHING ALL DAILY BS20 WITH BUP BS20
               KEY = POS 8,81-95,19-38,5
               UNMATCHED BS20 WILL BE STORED ON BS20 TABLE AND WRITTEN ON BUP
               MATCHED BS20 FROM DAILY WILL BE ALSO STORED AND WRITTEN ON BUP
               MATCHED BS20 FROM BUP WILL BE IGNORED
         -IF BS10-BS30
               MATCH DAILY BS10-BS30 WITH BUP BS10-BS30 - KEY =POS 8,81-95,19-35
               UNMATCHED RECORDS ARE COPIED ON BOTH OUTPUT FILES
               A GIVEN KEY CAN HAVE MORE THAN 1 RECORD DEPENDING ON THE PERIOD
                   -PERIOD = SPACES    DATA BY YEAR        ONE RECORD MAX
                   -PERIOD = Q.        DATA BY QUARTER     UP TO 4 REC
                   -PERIOD = 01-12     DATA BY MONTH       UP TO 12 REC
               IF THE BASE PERIOD IS DIFFERENT IN DAILY AND IN BUP FOR MATCHED
               RECORDS COPY DAILY INPUTS ONLY ON BOTH FILES.
               IF BASE PERIOD IS THE SAME MATCH ALSO BY PERIOD (42-43)
               RECORDS WITH UNMATCHED PERIOD ARE COPIED ON BOTH FILES
               FOR MATCHED PERIOD RECORDS BLANK FIELDS FROM DAILY RECORDS ARE
                  FILLED FROM CORRESPONDING BUP RECORD IF SAME CARD TYPE
                  FOR QTY CURR GROSS NET TERMS CAL-PAT
                  CARD TYPE IS KEPT FROM DAILY
                  RESULTING RECORD ARE COPIED ON DAILY FILE
                  RESULTING RECORD ARE COPIED ON BUP EXCEPT DELETE (POS 45 = '*'
               EVERY TIME YOU GENERATE A BS10-BS30 RECORD CHECK YOU DON'T MIX
               DAILY CARD TYPE.
         -AFTER ALL BS10-BS30 PROCESSING , BS20 TABLE WILL BE COPIED ON DAILY
               OUTPUT FILE AND REINITIALIZED
1 7.   CONTROL RECORDS.
       ----------------
           DURING PROCESSING CONTROL RECORD WILL BE MAINTAINED AND WRITTEN ON
           BACK-UP FILE AT OPCO BREAKDOWN, OR END OF FILE
           EVERY TIME A DAILY TRANSACTION IS READ (EXCEPT BS00) CONTROL WILL
           BE PASSED TO THIS MODULE
           CONTENT  -NBR RUNS   SPECIFIES IF YES (1) OR NOT (0) SUCH CARD TYPES
                                WERE ENCOUNTERED
                                TOT IS ALWAYS 1
                                FIGB MEANS BS10 OR BS20 OR BS30 (BUDGET DATA)
                    -TOT IN BU  ONLY SET UP AT END OF FILES
                    -REPORT REQUESTS   (ONLY FOR BSRR CARDS)
                                ONE POSITION BY REPORT NO (POS 74-76)
                                (NO SEL MEANS POS 9-72 = SPACE)
