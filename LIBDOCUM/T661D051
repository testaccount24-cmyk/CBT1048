1                              TOBY / SALES
0                                 T661P051
0                         BUDGIE EXIT FOR PRODUCT VALIDATION.
0                                                                  B WUILLAUME
0                                                                      05/77
- 1.   ENVIRONMENT
       -----------
1 2.   PURPOSE
       -------
0          THIS PROGRAM WILL RECEIVE FROM BUDGIE EVERY DAILY TRANSACTION AND
           VALIDATE THOSE WHICH NEED IT AGAINST PRODUCT MASTER FILE PREVIOUSLY
           LOADED UPON INTERNAL TABLE.
           PRODUCT OPENED IN THE SAME RUN WILL ALSO BE ACCEPTED.
- 5.   WORKING-STORAGE ORGANISATION.
       -----------------------------
0 5.1. SALES INPUT TRANSACTIONS.
       -------------------------
0          TRANSACTIONS RECEIVED VIA BUDGIE
           THREE CARD TYPES REMARKABLE
- 3.   INPUT FILES.
       ------------
0 3.1. PRODUCT FILE.
       -------------
0          SEQUENTIAL FILE CONTAINING ALL PRODUCTS OR MARKET GROUPS AUTHORIZED
           IN THE SYSTEM
           IF PRODUCT IS NOT SPACE,MARKET GROUP WILL BE BLANK OUT
                              = VALIDATION AGAINST PRODUCT ONLY
           IF PRODUCT IS SPACE = VALIDATION AGAINST MARKET GROUP
0          LENGTH : 120 BYTES
0          DDNAME : TSALPROD
0          FDLID  : TSALPROD
0          SEQUENCE : OPCO/FP/MKT/PLT-OR.
- 4.   OUTPUT FILES.
       -------------
0          NONE
                   - BSPR1A  PRODUCT CREATION
                             WILL BE USED AS REFERENCE IN PRODUCT VALIDATION
                   - BS1 BS2 BS3  SALES FIGURES
                             WILL BE VALIDATED AGAINST PRODUCT TABLES
                   - ALL OTHERS
                             WILL BE ACCEPTED WITHOUT ANY VALIDATION.
           THESE RECORDS DO NOT COME FROM A FILE BUT FROM THE BUDGIE LINKAGE
           AREA (CFR 5.2.)
0          RECORD LENGTH : 100 BYTES
0          SEQUENCE: BSPR1A CARDS WILL COME BEFORE SALES FIGURES
                     SALES FIGURES WILL COME BY BATCH BY OPERATING COMPANY
- 5.2. BUDGIE LINKAGE AREA.
       --------------------
0          ALL CONTROL INFORMATIONS COMING FROM / GOING TO BUDGIE PROGRAM.
           8 DIFFERENT FIELDS
               - 80 BYTES CARD IMAGE      (IGNORE)
               - 1 BYTE   CALL SWITCH
                            1 = INITIALIZE  (OPENS ETC)
                            2 = BATCH CARD  (LOAD PRODUCT FILE ON TABLE)
                            3 = DATA CARD
                                      BSPR1A      LOAD NEW PRODUCTS ON TABLE
                                   OR SALES FIGURES    VALIDATE PRODUCT CODE
                                   OR OTHER       IGNORE
                            4 = END     (CLOSE ETC)
                            OTHER = IGNORE
               - 1 BYTE   RETURN CODE
                            2 = SALES FIGURES WITH INVALID PRODUCT
                            0 = ALL OTHER CASES
               - 1 BYTE   RETURN CODE   ALWAYS ZERO
               - 30 BYTES ERROR MESSAGE
                            SPACE IF RECORD ACCEPTED
                            'MARKET GROUP INVALID'
                                  IF REJECTED AND FP CODE SPACE (POS 81-90)
                            'FP/PLANT/OWNER INVALID'
                                  IF REJECTED,OPCO #9 AND FP # SPACE
                            'FIBRE TYPE/PROD/ORIGIN INVALID'
                                  IF REJECTED,OPCO = 9 AND FP = SPACE
               - 2 BYTES  POSITION OF FIELD IN ERROR   ALWAYS '09'
               - 2 BYTES  LENGTH OF FIELD IN ERROR     ALWAYS '14'
               - 100 BYTES SALES INPUT TRANSACTION     (CFR 5-1)
- 5.3. LIVE-PRODUCTS TABLE.
       --------------------
0          WILL BE CREATED FROM THE PRODUCT FILE AT BATCH CARD PROCESSING TIME
           AND WILL CONTAIN ALL PRODUCTS/MARKET GROUPS AUTHORIZED FOR A GIVEN
           COMPANY
                   CODE & SEQUENCE : OPCO/PRODUCT CODE/MARKET GROUP/PLANT-ORIG
                   500 ENTRIES.
           THIS TABLE BEING IN SEQUENCE IT WILL BE ACCESSED WITH SEARCH ALL
           STATEMENT
- 5.4. NEW-PRODUCTS TABLE.
       -------------------
0          WILL BE CREATED FROM THE BSPR1A CARDS AT BEGINNING OF PROCESSING
           AND WILL CONTAIN ALL PRODUCTS/MARKET GROUPS OPENED IN THIS RUN FOR
           ALL COMPANIES TOGETHER.
                   CODE   SAME AS LIVE-PRODUCTS TABLE
                   50 ENTRIES
           THIS TABLE BEING OUT OF SEQUENCE IT WILL BE ACCESSED SEQUENTIALLY
1 6.   PROCESSING.
       -----------
0          THREE MAIN SECTIONS
                   - BSPR1A PROCESSING  (NEW PRODUCTS)
                   - BATCH CARD PROCESSING  (LOAD OPCO PRODUCTS)
                   - SALES FIGURES PROCESSING (VALIDATION)
0 6.1. BSPR1A PROCESSING.
0          CREATE NEW-PRODUCTS TABLE
           PROVIDE MESSAGE AND USER ABEND IN CASE OF OVERFLOW
0 6.2. BATCH CARD PROCESSING
0          READ PRODUCT FILE AND LOAD IN LIVE-PRODUCTS TABLE ALL RECORDS FOR
           THE INVOLVED COMPANY (POS 8)
           BATCHES WILL BE RECEIVED SORTED BY OPCO SO THAT THE PRODUCT FILE WILL
           BE READ ONLY ONCE AND WILL STAY POSITIONNED ON THE FOLLOWING OPCO
           FOR EVENTUAL OTHER BATCH CARD.
           THE SAME COMPANY COULD RECEIVE MORE THAN ONE BATCH.
           MARKET GROUP CODE MUST BE BLANK CODE IF FP SPECIFIED
0 6.3. SALES FIGURES PROCESSING
0          PRODUCT INFORMATIONS WILL BE VALIDATED AGAINST BOTH TABLES.
               A - SET UP KEY FOR COMPARISON
                             OPCO  (POS 8)
                             FP CODE  (POS 81-90)
                             MARKET GROUP (POS 91-95)
                             PLANT-ORIG (POS 19-22)
               B - TABLE LOOK-UP IN LIVE-PRODUCTS TABLE (SEARCH ALL)
               C - IF NOT FOUND,TABLE LOOK-UP IN NEW-PRODUCTS TABLE (SEQUENTIAL)
               D - IF NOT FOUND IN BOTH
                             SET RETURN CODE TO '2'
                             SET APPROPRIATE ERROR MESSAGE (CFR 5.2)
       ALL NON DEFINED TRANSACTIONS ARE CONSIDERED AS ACCEPTED
